<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì²´ìœ¡ ì„±ì·¨ê¸°ì¤€ ë¯¸ì…˜ í‰ê°€ ê²Œì„</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121a2b; --line:#22304f;
      --text:#e9eefc; --muted:#a7b4d6; --accent:#7aa8ff;
      --good:#55d18a; --warn:#ffd066; --bad:#ff6b6b;
      --chip:#1a2540;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:linear-gradient(180deg,#070c16 0%, #0b1220 60%, #070c16 100%);
      color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
    }
    header{
      padding:20px 18px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      position:sticky; top:0; background:rgba(11,18,32,0.9); backdrop-filter: blur(10px);
      z-index:10;
    }
    header h1{
      margin:0 0 6px 0; font-size:18px; letter-spacing: -0.2px;
    }
    header p{margin:0; color:var(--muted); font-size:13px}
    main{max-width:1100px; margin:0 auto; padding:18px}
    .grid{
      display:grid; gap:14px;
      grid-template-columns: 1.1fr 1fr;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background:rgba(18,26,43,0.92);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:16px;
      padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    .card h2{
      margin:0 0 12px 0;
      font-size:15px;
      color:var(--text);
      display:flex; align-items:center; gap:8px;
    }
    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      padding:2px 10px; border-radius:999px;
      background:rgba(122,168,255,0.15);
      border:1px solid rgba(122,168,255,0.25);
      color:var(--accent); font-size:12px;
    }
    label{display:block; font-size:13px; color:var(--muted); margin:10px 0 6px}
    input, select, button{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.12);
      background:#0e1628;
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    input::placeholder{color:#7282a8}
    .row{display:flex; gap:10px}
    .row > *{flex:1}
    .hint{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35}
    .domainBox{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
    }
    .chip{
      padding:6px 10px;
      background:rgba(26,37,64,0.8);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      user-select:none;
    }
    .chip strong{color:var(--text); font-weight:600}
    .missions{
      display:flex; flex-direction:column; gap:10px; margin-top:8px;
    }
    .mission{
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(14,22,40,0.72);
    }
    .missionTop{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .missionTitle{
      font-size:14px; margin:0; line-height:1.25;
    }
    .missionMeta{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .scoreRow{
      display:flex; gap:8px; align-items:center; margin-top:10px;
    }
    .scoreRow span{
      color:var(--muted); font-size:12px;
      min-width:64px;
    }
    .scoreRow .btns{
      display:flex; gap:6px; flex-wrap:wrap;
    }
    .scoreBtn{
      width:auto;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(26,37,64,0.9);
      color:var(--text);
      cursor:pointer;
      font-size:13px;
      transition:0.12s transform ease, 0.12s opacity ease;
    }
    .scoreBtn:hover{transform:translateY(-1px)}
    .scoreBtn[data-selected="true"]{
      border-color: rgba(122,168,255,0.7);
      box-shadow:0 0 0 3px rgba(122,168,255,0.15);
      background:rgba(122,168,255,0.18);
    }
    .panel{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:12px;
    }
    .panel button{
      width:auto;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      background:rgba(122,168,255,0.14);
      border:1px solid rgba(122,168,255,0.35);
    }
    .panel button.secondary{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
    }
    .panel button.danger{
      background:rgba(255,107,107,0.14);
      border:1px solid rgba(255,107,107,0.35);
    }
    .resultBox{
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(14,22,40,0.72);
    }
    .resultGrid{
      display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;
    }
    @media (max-width: 600px){
      .resultGrid{grid-template-columns:1fr}
    }
    .metric{
      padding:10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(18,26,43,0.55);
    }
    .metric .k{color:var(--muted); font-size:12px}
    .metric .v{font-size:18px; font-weight:700; margin-top:4px}
    .level{
      display:inline-flex; align-items:center; justify-content:center;
      padding:6px 10px;
      border-radius:999px;
      font-weight:700;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.06);
    }
    .level.high{color:var(--good); border-color:rgba(85,209,138,0.35); background:rgba(85,209,138,0.1)}
    .level.mid{color:var(--warn); border-color:rgba(255,208,102,0.35); background:rgba(255,208,102,0.1)}
    .level.low{color:var(--bad); border-color:rgba(255,107,107,0.35); background:rgba(255,107,107,0.1)}
    table{
      width:100%;
      border-collapse: collapse;
      margin-top:10px;
      overflow:hidden;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.08);
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      font-size:13px;
      text-align:left;
      vertical-align:top;
    }
    th{color:var(--muted); background:rgba(14,22,40,0.72)}
    tr:last-child td{border-bottom:none}
    .small{font-size:12px; color:var(--muted); margin-top:8px}
    .footer{
      padding:16px;
      text-align:center;
      color:var(--muted);
      font-size:12px;
      opacity:0.9;
    }
  </style>
</head>
<body>
<header>
  <h1>ì²´ìœ¡ ì„±ì·¨ê¸°ì¤€ ë¯¸ì…˜ í‰ê°€ ê²Œì„ <span class="badge">0~6ì  â†’ ìƒ/ì¤‘/í•˜</span></h1>
  <p>ì´ë¦„ ì…ë ¥ â†’ ì˜ì—­ ì„ íƒ â†’ ë¯¸ì…˜ 3ê°œ ì ìˆ˜(0~2) â†’ ìë™ ì„±ì·¨ë„ íŒì • â†’ ê¸°ë¡ ì €ì¥/CSV ë‚´ë³´ë‚´ê¸°</p>
</header>

<main>
  <div class="grid">
    <!-- ì¢Œì¸¡: ì„¤ì •/ë¯¸ì…˜ -->
    <section class="card">
      <h2>â‘  í•™ìƒ & ì˜ì—­ ì„ íƒ <span class="badge" id="groupBadge">-</span></h2>

      <div class="row">
        <div>
          <label for="studentName">í•™ìƒ ì´ë¦„</label>
          <input id="studentName" type="text" placeholder="ì˜ˆ: ê¹€OO" />
          <div class="hint">ì—¬ëŸ¬ ëª…ì„ ì—°ì† í‰ê°€í•  ë•ŒëŠ” ì €ì¥ í›„ ì´ë¦„ë§Œ ë°”ê¿”ë„ ë¼ìš”.</div>
        </div>
        <div>
          <label for="domainSelect">ì˜ì—­ ì„ íƒ</label>
          <select id="domainSelect"></select>
          <div class="hint" id="domainHint">ì„ íƒí•œ ì˜ì—­ì˜ ì„±ì·¨ê¸°ì¤€ ë²”ìœ„ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
      </div>

      <div class="domainBox" id="domainInfo"></div>

      <h2 style="margin-top:16px;">â‘¡ ë¯¸ì…˜ ìˆ˜í–‰(3ê°œ)</h2>
      <div class="missions" id="missionList"></div>

      <div class="resultBox" aria-live="polite">
        <div class="resultGrid">
          <div class="metric">
            <div class="k">ì´ì (0~6)</div>
            <div class="v" id="totalScore">0</div>
          </div>
          <div class="metric">
            <div class="k">ì„±ì·¨ë„</div>
            <div class="v" id="levelText"><span class="level low">í•˜</span></div>
          </div>
          <div class="metric">
            <div class="k">ì¦‰ì‹œ í”¼ë“œë°±</div>
            <div class="v" style="font-size:13px; font-weight:600; line-height:1.35;" id="feedbackText">
              ì ìˆ˜ë¥¼ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ í”¼ë“œë°±ì´ ë‚˜ì™€ìš”.
            </div>
          </div>
        </div>

        <div class="panel">
          <button id="saveBtn">âœ… ê¸°ë¡ ì €ì¥</button>
          <button class="secondary" id="resetBtn">â†©ï¸ ë¯¸ì…˜ ì´ˆê¸°í™”</button>
          <button class="secondary" id="copyBtn">ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
        </div>
        <div class="small">â€» íŒì • ê¸°ì¤€: 5~6ì =ìƒ / 3~4ì =ì¤‘ / 0~2ì =í•˜</div>
      </div>
    </section>

    <!-- ìš°ì¸¡: ê¸°ë¡ -->
    <section class="card">
      <h2>â‘¢ ì €ì¥ëœ ê¸°ë¡</h2>
      <div class="hint">ì €ì¥ëœ ê¸°ë¡ì€ ë¸Œë¼ìš°ì €(ì´ ì»´í“¨í„°)ì— ë‚¨ì•„ìš”. (localStorage ì‚¬ìš©)</div>

      <div class="panel">
        <button class="secondary" id="exportBtn">â¬‡ï¸ CSV ë‚´ë³´ë‚´ê¸°</button>
        <button class="danger" id="clearBtn">ğŸ—‘ï¸ ê¸°ë¡ ì „ì²´ ì‚­ì œ</button>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width:120px;">ë‚ ì§œ/ì‹œê°„</th>
            <th style="width:90px;">ì´ë¦„</th>
            <th>ì˜ì—­</th>
            <th style="width:70px;">ì´ì </th>
            <th style="width:70px;">ìˆ˜ì¤€</th>
          </tr>
        </thead>
        <tbody id="logBody">
          <tr><td colspan="5" style="color:var(--muted);">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ì–´ìš”.</td></tr>
        </tbody>
      </table>
      <div class="footer">ë¬¸ì •ëŒ€ ë²„ì „ Â· ì²´ìœ¡ ì„±ì·¨ê¸°ì¤€ ê¸°ë°˜ ê°„ë‹¨ í‰ê°€ ê²Œì„</div>
    </section>
  </div>
</main>

<script>
/** =========================
 *  ë°ì´í„°(8ê°œ ì˜ì—­)
 *  ========================= */
const DOMAINS = [
  {
    id: "health",
    title: "ê±´ê°•",
    range: "[9ì²´01-01~9ì²´01-14]",
    chips: ["ì²´ë ¥ì¦ì§„", "ì²´ë ¥ê´€ë¦¬", "ìš´ë™ì²˜ë°©", "ì‹ ì²´Â·ì •ì‹ Â·ì‚¬íšŒì  ê±´ê°•", "ì•ˆì „"],
    missions: [
      {
        id: "h_q",
        type: "Quiz",
        title: "í€´ì¦ˆ ë¯¸ì…˜",
        prompt: "ì²´ë ¥ ì¦ì§„Â·ì²´ë ¥ ê´€ë¦¬Â·ìš´ë™ ì²˜ë°©ì˜ ì°¨ì´ë¥¼ 1ë¬¸ì¥ì”© ë§í•´ë³´ê¸°(ë˜ëŠ” ì¹´ë“œ ì„ íƒ).",
        time: 4
      },
      {
        id: "h_p",
        type: "Practice",
        title: "ì‹¤ì²œ ë¯¸ì…˜",
        prompt: "ë‚´ ìˆ˜ì¤€ì— ë§ëŠ” ìˆœí™˜ìš´ë™ 1ì„¸íŠ¸(ì˜ˆ: ìŠ¤ì¿¼íŠ¸-í”Œë­í¬-ì™•ë³µë‹¬ë¦¬ê¸°) ì„ íƒ í›„ ì•ˆì „í•˜ê²Œ ìˆ˜í–‰.",
        time: 6
      },
      {
        id: "h_r",
        type: "Reflection",
        title: "ì„±ì°° ë¯¸ì…˜",
        prompt: "ì˜¤ëŠ˜ ëª¸ ìƒíƒœ(í˜¸í¡/í”¼ë¡œ/í†µì¦) ì ê²€ í›„ ë‹¤ìŒ ëª©í‘œ 1ê°œ + ì•ˆì „ ìˆ˜ì¹™ 1ê°œ ì ê¸°.",
        time: 3
      }
    ]
  },
  {
    id: "action",
    title: "ë™ì‘í˜• ìŠ¤í¬ì¸ ",
    range: "[9ì²´02-01~9ì²´02-03]",
    chips: ["ê¸°ìˆ  ìˆ˜í–‰", "ì›ë¦¬ ì ìš©", "ì „ëµ", "ì•ˆì „"],
    missions: [
      {
        id: "a_q",
        type: "Quiz",
        title: "ê·œì¹™/íŠ¹ì„± í€´ì¦ˆ",
        prompt: "ë™ì‘í˜• ìŠ¤í¬ì¸ ì˜ íŠ¹ì§•(ê¸°ìˆ  ìˆ˜í–‰Â·ë™ì‘ ì™„ì„±ë„)ì„ ì˜ˆì‹œë¡œ ì„¤ëª…í•˜ê¸°.",
        time: 3
      },
      {
        id: "a_p",
        type: "Practice",
        title: "ê¸°ìˆ  ìˆ˜í–‰ ë¯¸ì…˜",
        prompt: "ê¸°ë³¸ ê¸°ìˆ  1ê°œ(ì˜ˆ: ë“œë¦¬ë¸”/ìŠ¤í…/í„´)ë¥¼ 30ì´ˆê°„ ì •í™•í•˜ê²Œ ë°˜ë³µ ìˆ˜í–‰.",
        time: 5
      },
      {
        id: "a_s",
        type: "Strategy",
        title: "ì „ëµ ì ìš© ë¯¸ì…˜",
        prompt: "ìƒí™© ì¹´ë“œ 1ì¥ì„ ë½‘ì•„ 'ì–´ë–¤ ê¸°ìˆ ì„ ì™œ ì“°ëŠ”ì§€' ë§í•˜ê³  ì§§ê²Œ ì ìš©í•˜ê¸°.",
        time: 4
      }
    ]
  },
  {
    id: "combat",
    title: "íˆ¬ê¸°í˜• ìŠ¤í¬ì¸ ",
    range: "[9ì²´02-07~9ì²´02-09]",
    chips: ["ìƒëŒ€ ì¡´ì¤‘", "ì•ˆì „ê±°ë¦¬", "ê¸°ë³¸ ì›€ì§ì„", "ì˜ˆì ˆ"],
    missions: [
      {
        id: "c_q",
        type: "Quiz",
        title: "ì•ˆì „ í€´ì¦ˆ",
        prompt: "íˆ¬ê¸°í˜• ìŠ¤í¬ì¸ ì—ì„œ ì¤‘ìš”í•œ ì•ˆì „ ìš”ì†Œ 2ê°€ì§€(ì˜ˆ: ì•ˆì „ê±°ë¦¬, ê·œì¹™, ìƒëŒ€ ì¡´ì¤‘) ë§í•˜ê¸°.",
        time: 3
      },
      {
        id: "c_p",
        type: "Practice",
        title: "ê¸°ë³¸ ì›€ì§ì„ ë¯¸ì…˜",
        prompt: "ê¸°ë³¸ ìì„¸/ìŠ¤í…(ì•ë’¤Â·ì¢Œìš°) 30ì´ˆ + ë°©í–¥ ì „í™˜ 10íšŒ(ì¶©ëŒ ì—†ì´).",
        time: 5
      },
      {
        id: "c_e",
        type: "Etiquette",
        title: "ì˜ˆì ˆ ë¯¸ì…˜",
        prompt: "ì‹œì‘Â·ì¢…ë£Œ ì¸ì‚¬ + ê·œì¹™ ì¤€ìˆ˜ + ìƒëŒ€ ë°°ë ¤ í–‰ë™ 2ê°€ì§€ë¥¼ ì²´í¬í•˜ë©° ì‹¤ì²œí•˜ê¸°.",
        time: 3
      }
    ]
  },
  {
    id: "invasion",
    title: "ì˜ì—­í˜• ìŠ¤í¬ì¸ ",
    range: "[9ì²´02-10~9ì²´02-12]",
    chips: ["ê³µê°„ ë§Œë“¤ê¸°", "ì „í™˜", "íŒ¨ìŠ¤", "ìˆ˜ë¹„"],
    missions: [
      {
        id: "i_q",
        type: "Quiz",
        title: "ì „ìˆ  í€´ì¦ˆ",
        prompt: "ê³µê°„ ë§Œë“¤ê¸°/íŒ¨ìŠ¤ ê°ë„/ìˆ˜ë¹„ ì „í™˜ ì¤‘ 1ê°œë¥¼ ê³¨ë¼ ì‰¬ìš´ ì˜ˆë¡œ ì„¤ëª…í•˜ê¸°.",
        time: 3
      },
      {
        id: "i_p",
        type: "Practice",
        title: "íŒ¨ìŠ¤/ì—°ê³„ ë¯¸ì…˜",
        prompt: "2:1 íŒ¨ìŠ¤ ê²Œì„(ë˜ëŠ” 3ì¸ ë¦´ë ˆì´)ì—ì„œ ì •í™•í•œ íŒ¨ìŠ¤ 5íšŒ ì„±ê³µí•˜ê¸°.",
        time: 6
      },
      {
        id: "i_t",
        type: "Tactics",
        title: "ë¯¸ë‹ˆì „ìˆ  ë¯¸ì…˜",
        prompt: "ë¯¸ë‹ˆê²½ê¸° 1ë¶„ ë™ì•ˆ â€˜ê³µê°„ ë§Œë“¤ê¸°â€™ ì „ëµì„ 1ë²ˆ ì´ìƒ ì ìš©í•˜ê¸°.",
        time: 4
      }
    ]
  },
  {
    id: "field",
    title: "í•„ë“œí˜• ìŠ¤í¬ì¸ ",
    range: "[9ì²´02-13~9ì²´02-15]",
    chips: ["ê¸°ë¡/ì§„í–‰", "ê³µê°„", "ê¸°ëŠ¥ ìˆ˜í–‰", "ìƒí™© íŒë‹¨"],
    missions: [
      {
        id: "f_q",
        type: "Quiz",
        title: "íŠ¹ì„± í€´ì¦ˆ",
        prompt: "í•„ë“œí˜• ìŠ¤í¬ì¸ ì˜ íë¦„(ê³µê°„/ì´ë™/ì§„í–‰ ë°©ì‹)ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ë§í•˜ê¸°.",
        time: 3
      },
      {
        id: "f_p",
        type: "Practice",
        title: "ê¸°ëŠ¥ ë¯¸ì…˜",
        prompt: "ê¸°ë³¸ íƒ€ê²©/íŒ¨ìŠ¤/ìºì¹˜ ì¤‘ 1ê°œë¥¼ ì„ íƒí•´ 5íšŒ ì •í™•íˆ ì„±ê³µí•˜ê¸°.",
        time: 6
      },
      {
        id: "f_s",
        type: "Strategy",
        title: "ìƒí™©íŒë‹¨ ë¯¸ì…˜",
        prompt: "ìƒí™© ì¹´ë“œì—ì„œ ìµœì„ ì˜ ì„ íƒ(ì•ˆì „/ì„±ê³µí™•ë¥  ê³ ë ¤)ì„ ë§í•˜ê¸°.",
        time: 4
      }
    ]
  },
  {
    id: "net",
    title: "ë„¤íŠ¸í˜• ìŠ¤í¬ì¸ ",
    range: "[9ì²´02-16~9ì²´02-18]",
    chips: ["ì„œë¸Œ", "ë ë¦¬", "ê³µê°„", "ì „ëµ"],
    missions: [
      {
        id: "n_q",
        type: "Quiz",
        title: "ê·œì¹™ í€´ì¦ˆ",
        prompt: "ë“ì  ì¡°ê±´ 1ê°œ + ë°˜ì¹™ 1ê°œë¥¼ ë§í•´ë³´ê¸°.",
        time: 3
      },
      {
        id: "n_p",
        type: "Practice",
        title: "ë ë¦¬ ë¯¸ì…˜",
        prompt: "ì§ê³¼ ë ë¦¬ 10íšŒ ì´ì–´ê°€ê¸°(ì •í™•Â·ì•ˆì „ ì¤‘ì‹¬, ì‹¤íŒ¨í•´ë„ OK).",
        time: 6
      },
      {
        id: "n_g",
        type: "MiniGame",
        title: "ë¯¸ë‹ˆê²Œì„ ë¯¸ì…˜",
        prompt: "3ì  ë¯¸ë‹ˆê²Œì„ì—ì„œ ì„œë¸Œ-ë¦¬í„´-ë§ˆë¬´ë¦¬ ì „ëµì„ 1ë²ˆ ì´ìƒ ì‚¬ìš©í•˜ê¸°.",
        time: 4
      }
    ]
  },
  {
    id: "life",
    title: "ìƒí™œ/ìì—°í™˜ê²½í˜•+íƒœë„",
    range: "[9ì²´02-19~9ì²´02-27]",
    chips: ["ì•ˆì „", "í˜‘ë ¥", "ì˜ˆì ˆ", "ì§€ì†ê°€ëŠ¥", "ë„ì „"],
    missions: [
      {
        id: "l_q",
        type: "Quiz",
        title: "ì•ˆì „ í€´ì¦ˆ",
        prompt: "ìƒí™œ/ìì—°í™˜ê²½í˜• ìŠ¤í¬ì¸  ì•ˆì „ìˆ˜ì¹™ 2ê°€ì§€(ë‚ ì”¨/ì¥ë¹„/ì¥ì†Œ ë“±) ë§í•˜ê¸°.",
        time: 3
      },
      {
        id: "l_p",
        type: "Practice",
        title: "ìƒí™œìŠ¤í¬ì¸  ì‹¤ì²œ",
        prompt: "ê±·ê¸°/ì¤„ë„˜ê¸°/ê³„ë‹¨ ì˜¤ë¥´ê¸° ë“± ê°€ëŠ¥í•œ ìƒí™œìŠ¤í¬ì¸  1ê°œë¥¼ 3ë¶„ ì‹¤ì²œí•˜ê¸°.",
        time: 5
      },
      {
        id: "l_a",
        type: "Attitude",
        title: "íŒ€ì›Œí¬Â·ì˜ˆì ˆÂ·í™˜ê²½",
        prompt: "í˜‘ë ¥ 1íšŒ ì´ìƒ + ê²½ê¸° ì˜ˆì ˆ 1íšŒ ì´ìƒ + í™˜ê²½ ë°°ë ¤ í–‰ë™ 1ê°œ ì‹¤ì²œí•˜ê¸°.",
        time: 4
      }
    ]
  },
  {
    id: "expr",
    title: "ìŠ¤í¬ì¸  í‘œí˜„",
    range: "[9ì²´03-01~9ì²´03-10]",
    chips: ["ë¦¬ë“¬", "ê³µê°„", "ê°•ì•½", "ë™ì„ ", "ê°ìƒÂ·ë¹„í‰"],
    missions: [
      {
        id: "e_q",
        type: "Quiz",
        title: "í‘œí˜„ ìš”ì†Œ í€´ì¦ˆ",
        prompt: "í‘œí˜„ í™œë™ì˜ ì¤‘ìš”í•œ ìš”ì†Œ 2ê°€ì§€(ë¦¬ë“¬/ê³µê°„/ê°•ì•½/í‘œì • ë“±) ë§í•˜ê¸°.",
        time: 3
      },
      {
        id: "e_c",
        type: "Create",
        title: "ì°½ì‘ ë¯¸ì…˜",
        prompt: "8ì¹´ìš´íŠ¸ ë™ì‘ 1ê°œ ì°½ì‘(ì‹œì‘-ì „ê°œ-ë§ˆë¬´ë¦¬ í¬í•¨) â†’ ëª¨ë‘ ê³¼ ì—°ê²°í•˜ê¸°.",
        time: 7
      },
      {
        id: "e_r",
        type: "Reflect",
        title: "ê°ìƒÂ·ë¹„í‰ ë¯¸ì…˜",
        prompt: "ë‹¤ë¥¸ ëª¨ë‘ ì„ ë³´ê³  ì¢‹ì€ ì  1ê°œ + ê°œì„  ì œì•ˆ 1ê°œë¥¼ ì¡´ì¤‘ í‘œí˜„ìœ¼ë¡œ ë§í•˜ê¸°.",
        time: 3
      }
    ]
  }
];

/** =========================
 *  ìœ í‹¸
 *  ========================= */
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));

function nowKST() {
  // ë¡œì»¬ ì‹œê°„ ê·¸ëŒ€ë¡œ í‘œì‹œ(í•™êµ PC ê¸°ì¤€)
  const d = new Date();
  const pad = (n) => String(n).padStart(2, "0");
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

function levelFromScore(total){
  if (total >= 5) return {text:"ìƒ", cls:"high", msg:"ê°œë… ì´í•´ì™€ ì‹¤ì²œì´ ì•ˆì •ì ì´ì—ìš”. ë‹¤ìŒì€ 'ì „ëµ/ìê¸°ì£¼ë„ì„±'ì„ ë” ê°•í™”í•´ë´ìš”!"};
  if (total >= 3) return {text:"ì¤‘", cls:"mid", msg:"ê¸°ë³¸ì€ OK! í•œ ê°€ì§€ í•µì‹¬ í¬ì¸íŠ¸ë¥¼ ì •í•´ì„œ ë°˜ë³µ ì—°ìŠµí•˜ë©´ ê¸ˆë°© ì˜¬ë¼ê°€ìš”."};
  return {text:"í•˜", cls:"low", msg:"ê´œì°®ì•„ìš”. ì‰¬ìš´ ìˆ˜ì¤€ë¶€í„° ì•ˆì „í•˜ê²Œ ì„±ê³µ ê²½í—˜ì„ ë§Œë“¤ì–´ë´…ì‹œë‹¤."};
}

function safeText(s){
  return String(s ?? "").replace(/[<>&"]/g, (ch)=>({
    "<":"&lt;", ">":"&gt;", "&":"&amp;", '"':"&quot;"
  }[ch]));
}

/** =========================
 *  ìƒíƒœ
 *  ========================= */
let currentDomain = DOMAINS[0];
let missionScores = {}; // missionId -> 0/1/2

/** =========================
 *  ë Œë”
 *  ========================= */
function initDomainSelect(){
  const sel = $("#domainSelect");
  sel.innerHTML = DOMAINS.map(d => `<option value="${d.id}">${safeText(d.title)}</option>`).join("");
  sel.addEventListener("change", () => {
    const id = sel.value;
    currentDomain = DOMAINS.find(d => d.id === id) || DOMAINS[0];
    resetMissions(false);
    renderDomainInfo();
    renderMissions();
    updateResult();
  });
}

function renderDomainInfo(){
  $("#groupBadge").textContent = currentDomain.range;
  $("#domainHint").textContent = `ì„ íƒëœ ì˜ì—­: ${currentDomain.title} Â· ì„±ì·¨ê¸°ì¤€ ë²”ìœ„: ${currentDomain.range}`;
  const box = $("#domainInfo");
  box.innerHTML = currentDomain.chips.map(c => `<div class="chip"><strong>#</strong> ${safeText(c)}</div>`).join("");
}

function renderMissions(){
  const list = $("#missionList");
  list.innerHTML = "";

  currentDomain.missions.forEach((m, idx) => {
    const score = missionScores[m.id] ?? null;

    const wrap = document.createElement("div");
    wrap.className = "mission";
    wrap.innerHTML = `
      <div class="missionTop">
        <div>
          <p class="missionTitle">ë¯¸ì…˜ ${idx+1}. ${safeText(m.title)} <span class="badge">${safeText(m.type)}</span></p>
          <div class="missionMeta">â± ${m.time}ë¶„ Â· ${safeText(m.prompt)}</div>
        </div>
        <div class="badge" title="0~2ì  ì„ íƒ">ì ìˆ˜</div>
      </div>

      <div class="scoreRow">
        <span>ì„ íƒ</span>
        <div class="btns" data-mission="${m.id}">
          ${[0,1,2].map(v => `
            <button class="scoreBtn" type="button" data-score="${v}" data-selected="${score===v}">
              ${v}ì 
            </button>
          `).join("")}
        </div>
      </div>
    `;
    list.appendChild(wrap);
  });

  // ë²„íŠ¼ ì´ë²¤íŠ¸ ë°”ì¸ë”©
  $$(".btns").forEach(btnGroup => {
    btnGroup.addEventListener("click", (e) => {
      const btn = e.target.closest(".scoreBtn");
      if (!btn) return;

      const missionId = btnGroup.dataset.mission;
      const score = Number(btn.dataset.score);
      missionScores[missionId] = score;

      // í† ê¸€ UI
      Array.from(btnGroup.querySelectorAll(".scoreBtn")).forEach(b => b.dataset.selected = "false");
      btn.dataset.selected = "true";

      updateResult();
    });
  });
}

function calcTotal(){
  let total = 0;
  currentDomain.missions.forEach(m => {
    const s = missionScores[m.id];
    total += (typeof s === "number") ? s : 0;
  });
  return total;
}

function updateResult(){
  const total = calcTotal();
  $("#totalScore").textContent = total;

  const lvl = levelFromScore(total);
  $("#levelText").innerHTML = `<span class="level ${lvl.cls}">${lvl.text}</span>`;
  $("#feedbackText").textContent = lvl.msg;
}

function resetMissions(clearDomainSelect = true){
  missionScores = {};
  if (clearDomainSelect){
    currentDomain = DOMAINS[0];
    $("#domainSelect").value = currentDomain.id;
    renderDomainInfo();
  }
  renderMissions();
  updateResult();
}

/** =========================
 *  ì €ì¥/ê¸°ë¡
 *  ========================= */
const STORAGE_KEY = "pe_game_logs_v1";

function loadLogs(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return [];
    const arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr : [];
  }catch{
    return [];
  }
}

function saveLogs(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

function renderLogs(){
  const logs = loadLogs();
  const body = $("#logBody");
  if (!logs.length){
    body.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ì–´ìš”.</td></tr>`;
    return;
  }

  body.innerHTML = logs.slice().reverse().map(row => `
    <tr>
      <td>${safeText(row.time)}</td>
      <td>${safeText(row.name)}</td>
      <td>${safeText(row.domainTitle)} <span style="color:var(--muted); font-size:12px;">${safeText(row.range)}</span></td>
      <td><b>${row.total}</b></td>
      <td>${safeText(row.level)}</td>
    </tr>
  `).join("");
}

function buildResultText(){
  const name = $("#studentName").value.trim() || "(ì´ë¦„ ì—†ìŒ)";
  const total = calcTotal();
  const lvl = levelFromScore(total).text;

  const perMission = currentDomain.missions.map(m => {
    const s = missionScores[m.id];
    const val = (typeof s === "number") ? s : 0;
    return `- ${m.title}(${m.type}): ${val}ì `;
  }).join("\n");

  return `ì²´ìœ¡ ì„±ì·¨ê¸°ì¤€ ë¯¸ì…˜ í‰ê°€ ê²°ê³¼\n` +
         `ì´ë¦„: ${name}\n` +
         `ì˜ì—­: ${currentDomain.title} ${currentDomain.range}\n` +
         `ì´ì : ${total}/6ì \n` +
         `ìˆ˜ì¤€: ${lvl}\n\n` +
         `ë¯¸ì…˜ë³„ ì ìˆ˜\n${perMission}`;
}

function onSave(){
  const name = $("#studentName").value.trim();
  if (!name){
    alert("í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
    $("#studentName").focus();
    return;
  }

  const total = calcTotal();
  const lvl = levelFromScore(total).text;

  const logRow = {
    time: nowKST(),
    name,
    domainId: currentDomain.id,
    domainTitle: currentDomain.title,
    range: currentDomain.range,
    total,
    level: lvl,
    m1: missionScores[currentDomain.missions[0].id] ?? 0,
    m2: missionScores[currentDomain.missions[1].id] ?? 0,
    m3: missionScores[currentDomain.missions[2].id] ?? 0
  };

  const logs = loadLogs();
  logs.push(logRow);
  saveLogs(logs);
  renderLogs();

  alert("ì €ì¥ ì™„ë£Œ! ë‹¤ìŒ í•™ìƒ í‰ê°€ë¡œ ë„˜ì–´ê°€ë„ ë©ë‹ˆë‹¤ ğŸ˜Š");
}

function onCopy(){
  const text = buildResultText();
  navigator.clipboard?.writeText(text)
    .then(()=>alert("í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´ìš”!"))
    .catch(()=>{
      // fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      alert("í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´ìš”!");
    });
}

function exportCSV(){
  const logs = loadLogs();
  if (!logs.length){
    alert("ë‚´ë³´ë‚¼ ê¸°ë¡ì´ ì—†ì–´ìš”!");
    return;
  }

  const headers = ["time","name","domainTitle","range","total","level","m1","m2","m3"];
  const rows = logs.map(r => headers.map(h => {
    const val = (r[h] ?? "");
    // CSV escape
    const s = String(val).replace(/"/g, '""');
    return `"${s}"`;
  }).join(","));

  const csv = [headers.join(","), ...rows].join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `PE_Game_Logs_${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function clearLogs(){
  if (!confirm("ì •ë§ ê¸°ë¡ì„ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”? (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)")) return;
  localStorage.removeItem(STORAGE_KEY);
  renderLogs();
}

/** =========================
 *  ì´ˆê¸°í™”
 *  ========================= */
function init(){
  initDomainSelect();
  renderDomainInfo();
  renderMissions();
  updateResult();
  renderLogs();

  $("#saveBtn").addEventListener("click", onSave);
  $("#resetBtn").addEventListener("click", () => resetMissions(false));
  $("#copyBtn").addEventListener("click", onCopy);

  $("#exportBtn").addEventListener("click", exportCSV);
  $("#clearBtn").addEventListener("click", clearLogs);
}

init();
</script>
</body>
</html>
