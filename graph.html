<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PE Achievement Standards Graph</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Noto+Sans+KR:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background: transparent;
            font-family: 'Outfit', 'Noto Sans KR', sans-serif;
            overflow: hidden;
        }

        #cy {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        button {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: 0.3s;
        }

        button:hover {
            background: #f26a1b;
            color: white;
            border-color: #f26a1b;
        }
    </style>
</head>

<body>
    <div id="cy"></div>
    <div class="controls">
        <button onclick="resetLayout()">초기화</button>
    </div>

    <script>
        const elements = [
            // Root
            { data: { id: 'root', label: '체육 성취기준', color: '#1d3557', size: 80 } },

            // Categories
            { data: { id: '9체01', label: '건강·체력', color: '#f26a1b', size: 60 } },
            { data: { id: '9체02', label: '스포츠', color: '#2d6a4f', size: 60 } },
            { data: { id: '9체03', label: '표현', color: '#0077b6', size: 60 } },

            // Edges to Categories
            { data: { source: 'root', target: '9체01' } },
            { data: { source: 'root', target: '9체02' } },
            { data: { source: 'root', target: '9체03' } },

            // Sub-nodes for 9체01
            { data: { id: '9체01-01', label: '체력 증진', color: '#f26a1b', size: 40 } },
            { data: { id: '9체01-03', label: '체력 관리', color: '#f26a1b', size: 40 } },
            { data: { id: '9체01-05', label: '운동 처방', color: '#f26a1b', size: 40 } },
            { data: { id: '9체01-07', label: '신체 건강', color: '#f26a1b', size: 40 } },
            { data: { id: '9체01-09', label: '정신 건강', color: '#f26a1b', size: 40 } },
            { data: { id: '9체01-11', label: '사회적 건강', color: '#f26a1b', size: 40 } },

            { data: { source: '9체01', target: '9체01-01' } },
            { data: { source: '9체01', target: '9체01-03' } },
            { data: { source: '9체01', target: '9체01-05' } },
            { data: { source: '9체01', target: '9체01-07' } },
            { data: { source: '9체01', target: '9체01-09' } },
            { data: { source: '9체01', target: '9체01-11' } },

            // Sub-nodes for 9체02
            { data: { id: '9체02-01', label: '동작형', color: '#2d6a4f', size: 40 } },
            { data: { id: '9체02-04', label: '기록형', color: '#2d6a4f', size: 40 } },
            { data: { id: '9체02-07', label: '투기형', color: '#2d6a4f', size: 40 } },
            { data: { id: '9체02-10', label: '영역형', color: '#2d6a4f', size: 40 } },
            { data: { id: '9체02-13', label: '필드형', color: '#2d6a4f', size: 40 } },
            { data: { id: '9체02-16', label: '네트형', color: '#2d6a4f', size: 40 } },
            { data: { id: '9체02-19', label: '생활환경형', color: '#2d6a4f', size: 40 } },
            { data: { id: '9체02-22', label: '자연환경형', color: '#2d6a4f', size: 40 } },

            { data: { source: '9체02', target: '9체02-01' } },
            { data: { source: '9체02', target: '9체02-04' } },
            { data: { source: '9체02', target: '9체02-07' } },
            { data: { source: '9체02', target: '9체02-10' } },
            { data: { source: '9체02', target: '9체02-13' } },
            { data: { source: '9체02', target: '9체02-16' } },
            { data: { source: '9체02', target: '9체02-19' } },
            { data: { source: '9체02', target: '9체02-22' } },

            // Sub-nodes for 9체03
            { data: { id: '9체03-01', label: '스포츠 표현', color: '#0077b6', size: 40 } },
            { data: { id: '9체03-04', label: '전통 표현', color: '#0077b6', size: 40 } },
            { data: { id: '9체03-07', label: '현대 표현', color: '#0077b6', size: 40 } },

            { data: { source: '9체03', target: '9체03-01' } },
            { data: { source: '9체03', target: '9체03-04' } },
            { data: { source: '9체03', target: '9체03-07' } }
        ];

        const cy = cytoscape({
            container: document.getElementById('cy'),
            elements: elements,
            style: [
                {
                    selector: 'node',
                    style: {
                        'background-color': 'data(color)',
                        'label': 'data(label)',
                        'width': 'data(size)',
                        'height': 'data(size)',
                        'color': '#333',
                        'font-size': '12px',
                        'font-weight': 'bold',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'border-width': 4,
                        'border-color': '#fff',
                        'border-opacity': 0.8,
                        'transition-property': 'background-color, line-color, target-arrow-color, width, height',
                        'transition-duration': '0.3s'
                    }
                },
                {
                    selector: 'node[id="root"]',
                    style: {
                        'color': '#fff',
                        'font-size': '14px',
                        'text-outline-width': 2,
                        'text-outline-color': '#1d3557'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#ccc',
                        'target-arrow-color': '#ccc',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier',
                        'opacity': 0.6
                    }
                },
                {
                    selector: 'node:selected',
                    style: {
                        'border-color': '#f26a1b',
                        'border-width': 6
                    }
                },
                {
                    selector: '.faded',
                    style: {
                        'opacity': 0.1,
                        'text-opacity': 0
                    }
                },
                {
                    selector: '.highlighted',
                    style: {
                        'opacity': 1,
                        'text-opacity': 1,
                        'font-size': '16px'
                    }
                },
                {
                    selector: 'edge.faded',
                    style: {
                        'opacity': 0.05
                    }
                },
                {
                    selector: 'edge.highlighted',
                    style: {
                        'opacity': 0.8,
                        'width': 4,
                        'line-color': '#f26a1b'
                    }
                }
            ],
            layout: {
                name: 'cose',
                animate: true,
                padding: 50,
                componentSpacing: 100,
                nodeRepulsion: 400000,
                idealEdgeLength: 100
            }
        });

        cy.on('tap', 'node', function (evt) {
            const node = evt.target;
            console.log('Tapped ' + node.id());
            // Optional: highlight connected nodes
            cy.elements().removeClass('highlighted');
            node.neighborhood().addClass('highlighted');
            node.addClass('highlighted');
        });

        cy.on('tap', function (evt) {
            if (evt.target === cy) {
                cy.elements().removeClass('highlighted');
            }
        });

        window.addEventListener('message', (event) => {
            if (event.data.type === 'focus') {
                const category = event.data.category;

                if (category === 'all') {
                    cy.elements().removeClass('faded highlighted');
                    cy.animate({
                        fit: {
                            eles: cy.elements(),
                            padding: 50
                        },
                        duration: 500
                    });
                    return;
                }

                // Map category names to IDs
                const catIdMap = {
                    '9체01': '9체01',
                    '9체02': '9체02',
                    '9체03': '9체03'
                };

                const targetId = catIdMap[category];
                if (targetId) {
                    const targetNode = cy.getElementById(targetId);
                    const neighborhood = targetNode.closedNeighborhood();

                    cy.elements().addClass('faded').removeClass('highlighted');
                    neighborhood.removeClass('faded').addClass('highlighted');

                    cy.animate({
                        zoom: 1.2,
                        center: { eles: targetNode },
                        duration: 500
                    });
                }
            }
        });

        function resetLayout() {
            cy.elements().removeClass('faded highlighted');
            cy.layout({
                name: 'cose',
                animate: true
            }).run();
            cy.fit();
        }

        window.addEventListener('resize', () => {
            cy.fit();
        });
    </script>
</body>

</html>